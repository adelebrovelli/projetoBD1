CREATE TABLE Pessoa (
  Nome VARCHAR(30),
  Endereco VARCHAR(255),
  Email VARCHAR(50),
  CPF VARCHAR(11) PRIMARY KEY,
  DT_Nascimento DATE
);

CREATE TABLE Medico (
  CRM VARCHAR(8),
  Especialidade VARCHAR(255),
  fk_Pessoa_CPF VARCHAR(11),
  PRIMARY KEY (CRM, fk_Pessoa_CPF),
  FOREIGN KEY (fk_Pessoa_CPF) REFERENCES Pessoa (CPF) ON DELETE CASCADE
);

CREATE TABLE Paciente (
  Caso VARCHAR(255),
  ID_Paciente VARCHAR(255),
  fk_Pessoa_CPF VARCHAR(11),
  PRIMARY KEY (ID_Paciente, fk_Pessoa_CPF),
  FOREIGN KEY (fk_Pessoa_CPF) REFERENCES Pessoa (CPF) ON DELETE CASCADE
);

CREATE TABLE Ent_Consulta_Consulta (
  fk_Medico_CRM VARCHAR(8),
  fk_Medico_fk_Pessoa_CPF VARCHAR(11),
  fk_Paciente_ID_Paciente VARCHAR(255),
  fk_Paciente_fk_Pessoa_CPF VARCHAR(11),
  Sala INT(2),
  Data DATE PRIMARY KEY,
  FOREIGN KEY (fk_Medico_CRM, fk_Medico_fk_Pessoa_CPF) REFERENCES Medico (CRM, fk_Pessoa_CPF),
  FOREIGN KEY (fk_Paciente_ID_Paciente, fk_Paciente_fk_Pessoa_CPF) REFERENCES Paciente (ID_Paciente, fk_Pessoa_CPF)
);

CREATE TABLE Cliente (
  ID_Cliente VARCHAR(255),
  fk_Pessoa_CPF VARCHAR(11),
  PRIMARY KEY (ID_Cliente, fk_Pessoa_CPF),
  FOREIGN KEY (fk_Pessoa_CPF) REFERENCES Pessoa (CPF) ON DELETE CASCADE
);

CREATE TABLE Pedido (
  ID_Pedido VARCHAR(255) PRIMARY KEY,
  Preco_t FLOAT,
  Delivery BOOLEAN,
  fk_Data_Data_PK DATE,
  FOREIGN KEY (fk_Data_Data_PK) REFERENCES Data (Data_PK) ON DELETE SET NULL
);

CREATE TABLE Item (
  ID_Item VARCHAR(255) PRIMARY KEY,
  Preco_Item FLOAT,
  Nome_Item VARCHAR(255)
);

CREATE TABLE Participante (
  fk_Pessoa_CPF VARCHAR(11) PRIMARY KEY,
  Nome VARCHAR(255),
  FOREIGN KEY (fk_Pessoa_CPF) REFERENCES Pessoa (CPF) ON DELETE CASCADE
);

CREATE TABLE E_Assoc1_Inscricao (
  fk_Evento_Data_Evento DATE,
  fk_Participante_fk_Pessoa_CPF VARCHAR(11),
  ID_Inscricao VARCHAR(255) PRIMARY KEY,
  Contagem INT(10),
  Frequencia BOOLEAN,
  Satisfacao INT(5),
  FOREIGN KEY (fk_Evento_Data_Evento) REFERENCES Evento (Data_Evento),
  FOREIGN KEY (fk_Participante_fk_Pessoa_CPF) REFERENCES Participante (fk_Pessoa_CPF)
);

CREATE TABLE Evento (
  Nome_Evento VARCHAR(255),
  Data_Evento DATE PRIMARY KEY,
  Online BOOLEAN,
  fk_Local_ID_Local VARCHAR(255),
  FOREIGN KEY (fk_Local_ID_Local) REFERENCES Local (ID_Local) ON DELETE SET NULL
);

CREATE TABLE Local (
  Capacidade INT(10),
  ID_Local VARCHAR(255) PRIMARY KEY
);

CREATE TABLE Data (
  Data_PK DATE NOT NULL PRIMARY KEY,
  Dia VARCHAR(7),
  Hora TIME
);

CREATE TABLE Realiza (
  fk_Cliente_ID_Cliente VARCHAR(255),
  fk_Cliente_fk_Pessoa_CPF VARCHAR(11),
  fk_Pedido_ID_Pedido VARCHAR(255),
  FOREIGN KEY (fk_Cliente_ID_Cliente, fk_Cliente_fk_Pessoa_CPF) REFERENCES Cliente (ID_Cliente, fk_Pessoa_CPF) ON DELETE RESTRICT,
  FOREIGN KEY (fk_Pedido_ID_Pedido) REFERENCES Pedido (ID_Pedido) ON DELETE RESTRICT
);

CREATE TABLE Contem (
  fk_Pedido_ID_Pedido VARCHAR(255),
  fk_Item_ID_Item VARCHAR(255),
  FOREIGN KEY (fk_Pedido_ID_Pedido) REFERENCES Pedido (ID_Pedido) ON DELETE RESTRICT,
  FOREIGN KEY (fk_Item_ID_Item) REFERENCES Item (ID_Item) ON DELETE RESTRICT
);

-- Inserindo em Pessoa
INSERT INTO Pessoa (Nome, Endereco, Email, CPF, DT_Nascimento)
VALUES ('Carlos Silva', 'Rua A, 123', 'carlos@example.com', '12345678901', '1980-05-15'),
       ('Ana Pereira', 'Rua B, 456', 'ana@example.com', '10987654321', '1990-08-10');

-- Inserindo em Medico
INSERT INTO Medico (CRM, Especialidade, fk_Pessoa_CPF)
VALUES ('CRM12345', 'Cardiologia', '12345678901');

-- Inserindo em Paciente
INSERT INTO Paciente (Caso, ID_Paciente, fk_Pessoa_CPF)
VALUES ('Depressão', 'PAC001', '10987654321');

-- Inserindo em Cliente
INSERT INTO Cliente (ID_Cliente, fk_Pessoa_CPF)
VALUES ('CLI001', '10987654321');

-- Inserindo em Data
INSERT INTO Data (Data_PK, Dia, Hora)
VALUES ('2024-01-01', 'Segunda', '09:00:00');

-- Inserindo em Pedido
INSERT INTO Pedido (ID_Pedido, Preco_t, Delivery, fk_Data_Data_PK)
VALUES ('PED001', 250.00, TRUE, '2024-01-01');

-- Inserindo em Item
INSERT INTO Item (ID_Item, Preco_Item, Nome_Item)
VALUES ('IT001', 25.00, 'Pizza'), 
       ('IT002', 15.00, 'Salada');

-- Inserindo em Contem
INSERT INTO Contem (fk_Pedido_ID_Pedido, fk_Item_ID_Item)
VALUES ('PED001', 'IT001'),
       ('PED001', 'IT002');

-- Inserindo em Local
INSERT INTO Local (Capacidade, ID_Local)
VALUES (100, 'LOC001');

-- Inserindo em Evento
INSERT INTO Evento (Nome_Evento, Data_Evento, Online, fk_Local_ID_Local)
VALUES ('Yoga', '2024-03-10', FALSE, 'LOC001');

-- Inserindo em Participante
INSERT INTO Participante (fk_Pessoa_CPF, Nome)
VALUES ('10987654321', 'Ana Pereira'), ('12345678901', 'Carlos Silva');

-- Inserindo em E_Assoc1_Inscricao
INSERT INTO E_Assoc1_Inscricao (fk_Evento_Data_Evento, fk_Participante_fk_Pessoa_CPF, ID_Inscricao, Contagem, Frequencia, Satisfacao)
VALUES ('2024-03-10', '10987654321', 'INS001', 1, TRUE, 5), (2024-03-10, '12345678901', 'INS002', 2, TRUE, 5);

-- Inserindo em Ent_Consulta_Consulta
INSERT INTO Ent_Consulta_Consulta (fk_Medico_CRM, fk_Medico_fk_Pessoa_CPF, fk_Paciente_ID_Paciente, fk_Paciente_fk_Pessoa_CPF, Sala, Data)
VALUES ('CRM12345', '12345678901', 'PAC001', '10987654321', 1, '2024-02-20');

-- Inserindo em Realiza
INSERT INTO Realiza (fk_Cliente_ID_Cliente, fk_Cliente_fk_Pessoa_CPF, fk_Pedido_ID_Pedido)
VALUES ('CLI001', '10987654321', 'PED001');

SELECT COUNT(*) AS total_Pessoas 
FROM Pessoa;

SELECT COUNT(*) AS total_depres FROM Paciente WHERE Caso IS 'Depressão';

SELECT COUNT(*) AS satisfeitos FROM E_Assoc1_Inscricao WHERE Satisfacao > 4;
-- os pacientes estão satisfeitos com a clínica?
SELECT capacidade - contagem AS capacidade_restante FROM Local, E_Assoc1_Inscricao WHERE ID_Local = 'LOC001';
-- os pacientes realmente frequentam os eventos?
-- taxa de sucesso/retencao
-- quantos médicos da florence são especializados em casos mais raros?
-- qual o impacto dos eventos e campanhas no aumento de pedidos (colocar pacientes que frequentam mtos eventos como os q mais pedem e consultam
